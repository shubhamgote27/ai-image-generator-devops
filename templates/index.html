<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>AI Image Generator — AI Gen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
</head>

<body class="bg-gradient-to-br from-black via-gray-900 to-purple-900 min-h-screen text-white">

<div class="container mx-auto px-4 sm:px-6 py-6 sm:py-10">

    <!-- Header -->
    <header class="mb-10 text-center sm:text-left">
        <h1 class="text-3xl sm:text-4xl font-extrabold leading-tight">
            AI Image Generator
        </h1>
        <p class="mt-2 text-sm sm:text-base text-gray-300">
            Flux AI Gen API • <span class="text-purple-300">AWS Backend (REST API)</span>
        </p>

        <div class="mt-4 flex justify-center sm:justify-start">
            <a href="https://github.com/shubhamgote27" target="_blank"
               class="inline-flex items-center gap-2 bg-white/5 px-3 py-2 rounded-lg border border-white/10 text-sm hover:bg-white/10 transition">
                <i data-feather="github" class="w-4 h-4"></i>
                <span>Shubham Gote (@shubhamgote27)</span>
            </a>
        </div>
    </header>

    <!-- FORM -->
    <form id="genForm"
          class="max-w-xl mx-auto bg-white/10 backdrop-blur-xl p-5 sm:p-6 rounded-lg border border-white/10 shadow-xl space-y-4">

        <label class="text-sm text-gray-300">Enter a prompt</label>
        <input type="text" name="prompt" required
               placeholder="A futuristic city with floating islands..."
               class="w-full p-3 rounded-lg bg-white/5 border border-white/10 text-white text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-purple-600">

        <!-- Buttons stacked on mobile -->
        <div class="flex flex-col sm:flex-row gap-3">
            <button type="submit"
                    class="flex-1 bg-purple-600 hover:bg-purple-700 p-3 rounded-lg font-bold transition text-sm sm:text-base">
                Generate Image
            </button>

            <button id="clearBtn" type="button"
                    class="bg-white/5 hover:bg-white/10 p-3 rounded-lg border border-white/10 text-sm">
                Clear Gallery
            </button>
        </div>
    </form>

    <!-- LOADING -->
    <div id="loading"
         class="text-center hidden mt-6 text-base sm:text-lg font-semibold animate-pulse text-purple-300">
        Generating your image... ✨
    </div>

    <!-- GALLERY -->
    <div id="gallery"
         class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-10">
    </div>

    <!-- FOOTER -->
    <footer class="mt-12 text-center text-xs sm:text-sm text-gray-400 pb-6">
        Built by <a href="https://github.com/shubhamgote27" class="text-purple-300 hover:underline">Shubham Gote</a> • Flux AI Gen API • AWS REST backend
    </footer>
</div>


<script>
function refreshIcons() {
    feather.replace();
}

// Escape HTML for prompt display safety
function escapeHtml(text) {
    return text.replaceAll("&", "&amp;")
               .replaceAll("<", "&lt;")
               .replaceAll(">", "&gt;")
               .replaceAll('"', "&quot;")
               .replaceAll("'", "&#039;");
}

document.getElementById("genForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(e.target);
    const prompt = formData.get("prompt").trim();

    const loading = document.getElementById("loading");
    const gallery = document.getElementById("gallery");

    loading.classList.remove("hidden");

    // API request
    let res = await fetch("/generate", {
        method: "POST",
        body: formData
    });
    let data = await res.json();

    loading.classList.add("hidden");

    if (data.success) {
        const imageUrl = data.image;

        // Create responsive card
        const card = document.createElement("div");
        card.className =
            "bg-white/10 p-4 rounded-lg border border-white/10 shadow-lg hover:scale-[1.02] transition duration-200";

        card.innerHTML = `
            <!-- Badges -->
            <div class="flex gap-2 mb-3">
                <span class="text-xs bg-black/40 px-2 py-1 rounded-md border border-white/10 text-purple-200 whitespace-nowrap">Flux AI Gen</span>
                <span class="text-xs bg-black/25 px-2 py-1 rounded-md border border-white/5 text-gray-300 whitespace-nowrap">AWS REST</span>
            </div>

            <!-- Image -->
            <img src="${imageUrl}"
                 class="w-full rounded-md object-cover mb-4">

            <!-- Prompt Box -->
            <div class="bg-black/20 p-3 rounded-md border border-white/10">
                <p class="text-xs text-purple-200 font-semibold mb-2">Prompt</p>

                <div class="flex flex-col sm:flex-row sm:items-start gap-3">
                    <p class="text-sm text-white break-words flex-1">${escapeHtml(prompt)}</p>

                    <button class="copy-btn self-start bg-white/5 hover:bg-white/10 p-2 rounded-md border border-white/10"
                            title="Copy prompt">
                        <i data-feather="copy"></i>
                    </button>
                </div>
            </div>

            <!-- Download Button -->
            <a href="${imageUrl}" target="_blank"
               class="mt-3 block text-center bg-purple-600 hover:bg-purple-700 px-3 py-2 rounded-md text-sm">
               Download Full Image
            </a>
        `;

        // Add new card on top
        gallery.prepend(card);

        // Copy button logic
        const copyBtn = card.querySelector(".copy-btn");
        copyBtn.addEventListener("click", () => {
            navigator.clipboard.writeText(prompt);
            copyBtn.innerHTML = '<i data-feather="check"></i>';
            refreshIcons();
            setTimeout(() => {
                copyBtn.innerHTML = '<i data-feather="copy"></i>';
                refreshIcons();
            }, 1500);
        });

        refreshIcons(); // load icons in new elements
        e.target.reset();
    }
});

// Clear gallery
document.getElementById("clearBtn").addEventListener("click", () => {
    document.getElementById("gallery").innerHTML = "";
});

refreshIcons();

// Scroll to Top Button Logic
const scrollTopBtn = document.getElementById("scrollTopBtn");

window.addEventListener("scroll", () => {
    if (window.scrollY > 300) {
        scrollTopBtn.classList.remove("hidden");
    } else {
        scrollTopBtn.classList.add("hidden");
    }
});

scrollTopBtn.addEventListener("click", () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
});

</script>

<!-- Scroll to Top Button -->
<button id="scrollTopBtn"
    class="fixed bottom-5 right-5 bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-full shadow-xl border border-white/20 hidden transition transform hover:scale-110">
    <i data-feather="arrow-up"></i>
</button>

</body>
</html>
